# Excel脚本编写说明

## 文件基础规范

- **文件名**：必须命名为 `test plan.xlsx`。
- **结构**：Excel 文件内包含两类 Sheet（工作表）：
  1. **Config**：全局配置与执行顺序（有且仅有一个）。
  2. **业务动作表**（如 `Login`, `BLE_Test` 等）：定义具体的操作步骤。

## Config 表编写说明

此表用于定义测试的全局参数和任务执行逻辑。请严格保留表头格式。

### 🅰️ 全局配置区域 (A列-B列)

| **配置项 (Key)**   | **示例值 (Value)**   | **说明**                                                     |
| ------------------ | -------------------- | ------------------------------------------------------------ |
| **target_pkg**     | `com.example.app`    | **[必填]** 待测应用的包名（Package Name）。                  |
| **start_activity** | `.MainActivity`      | **[必填]** 应用启动页 Activity，用于崩溃后自动拉起。         |
| **duration_value** | `3`                  | **[必填]** 测试时长数值。                                    |
| **duration_unit**  | `day`                | **[必填]** 时长单位。支持 `day`, `hour`, `min`, `sec`。      |
| **ping_target**    | `192.168.1.1`        | **[选填]** 网络检测目标 IP 或域名。内网环境建议填网关 IP，外网填 `www.baidu.com`。 |
| **log_whitelist**  | `BluetoothAdapter:D` | **[选填]** 日志白名单。需抓取 Debug 级别的 Tag，多个用空格隔开。 |

### 🅱️ 执行计划区域 (C列-D列)

定义测试的“剧本”。工具会按照顺序依次执行每个 Sheet，并支持循环嵌套。

| **执行顺序 (Sheet Name)** | **本轮循环次数 (Loop)** | **说明**                                         |
| ------------------------- | ----------------------- | ------------------------------------------------ |
| `Login`                   | `1`                     | 先执行 Login 表里的动作 1 次。                   |
| `Video_Loop`              | `100`                   | 然后执行 Video_Loop 表里的动作 100 次。          |
| `Settings`                | `50`                    | 最后执行 Settings 表里的动作 50 次。             |
| *(空)*                    |                         | 执行完后，重新从第一行开始，直到达到总测试时长。 |

## 业务动作表 (Action Sheet) 编写说明

你可以创建任意名称的 Sheet（如 `BLE`、`Change`），用于编写具体的测试步骤。

表头格式：

指令, 参数1 (P1), 参数2 (P2), 参数3 (P3), 参数4 (P4), 重复, 备注。

### 指令对照表

| **指令 (Action)** | **参数1 (P1)** | **参数2 (P2)** | **参数3/4** | **说明**                                                     |
| ----------------- | -------------- | -------------- | ----------- | ------------------------------------------------------------ |
| **CLICK**         | X坐标          | Y坐标          | -           | 点击屏幕指定位置。 例：`500`, `1000`                         |
| **SWIPE**         | 起点X          | 起点Y          | 终点X/Y     | 滑动屏幕。 例：`500`, `1500`, `500`, `500` (上滑)            |
| **WAIT**          | 秒数           | -              | -           | 等待固定时间。 例：`2` (等待2秒)                             |
| **TEXT**          | 内容           | -              | -           | **输入文本**。 ⚠️ **仅支持英文/数字**，严禁中文。 例：`wifi_password` |
| **KEY**           | KeyCode        | -              | -           | 模拟物理按键。 例：`3` (Home键), `4` (返回键), `26` (电源键) |
| **ASSERT**        | 关键字         | 等待秒数       | -           | **断言/检查点**（高级）。 执行后等待 P2 秒，检查日志是否包含 P1 关键字。 例：`Send Success`, `3` |
| **STOP**          | -              | -              | -           | 强制杀掉当前测试应用。                                       |
| **START**         | -              | -              | -           | 重新冷启动测试应用。                                         |
| **SHELL**         | 命令           | -              | -           | 执行任意 ADB Shell 命令。 例：`input tap 100 100`            |

## 编写注意事项 (必读)

1. **关于坐标 (X, Y)**：
   - 请开启手机的 **“开发者选项” -> “指针位置”**，在屏幕上点击即可看到顶部的 X/Y 坐标数据。
   - 不同分辨率的设备坐标不同，更换设备需重新校对。
2. **关于文本输入 (TEXT)**：
   - **⚠️ 限制**：脚本通过 ADB 模拟键盘，**不支持输入中文**。
   - **建议**：测试机请使用系统自带的 **英文键盘** 或 **ADB Keyboard**，避免第三方输入法导致输入失败。
3. **关于断言 (ASSERT)**：
   - 这是验证业务逻辑的关键。例如：点击“发送蓝牙”后，添加一行 `ASSERT`, `Bluetooth Success`, `2`。
   - 如果脚本在 2 秒内的日志里没找到 "Bluetooth Success"，会记为**严重错误**并截图。
4. **关于日志白名单**：
   - 默认情况下，报告只统计 `Info` 级别以上的日志。
   - 如果你需要验证的 `ASSERT` 关键字只在 `Debug` 日志里打印，请务必在 Config 表的 `log_whitelist` 中配置对应的 Tag。
5. **避免空行**：
   - 在 Config 表和动作表中，尽量不要留中间空行，以免脚本解析中断。
